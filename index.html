<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Be My Valentine ðŸ’˜</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%; height: 100%;
  font-family: 'Comic Sans MS', cursive, sans-serif;
  overflow: hidden;
  background: #ffe0e8;
}

/* Grid 5x2 */
#backgroundGrid {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  display: none; z-index: 0;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap: 2px;
}

#backgroundGrid > div {
  position: relative;
  border: 1px solid #eee;
  overflow: hidden;
}

.grid-media {
  position: absolute;
  width: 100%; height: 100%;
  top: 0; left: 0;
  object-fit: cover;
  opacity: 1;
  transition: opacity 1s ease;
}

.overlay {
  position: absolute; left: 50%; top: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255,255,255,0.98);
  padding: 40px;
  border-radius: 20px;
  text-align: center;
  z-index: 10;
  min-width: 320px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

button {
  font-size: 1.2rem; padding: 12px 30px;
  border: none; border-radius: 30px;
  cursor: pointer; margin: 5px;
}

#yes { background: #ff4d6d; color: white; }
#no  { background: #ccc; color: #333; }
</style>
</head>
<body>

<div id="backgroundGrid"></div>

<div class="overlay" id="questionCard">
  <h1>Can you be my Valentine? ðŸ’–</h1>
  <button id="yes">Yes ðŸ’˜</button>
  <button id="no">No ðŸ’”</button>
</div>

<div class="overlay" id="celebrateCard" style="display:none;">
  ðŸŽ‰ðŸ’– YAY!! HAPPY VALENTINEâ€™S DAY ðŸ’–ðŸŽ‰<br>
  <div>Thank you, Love. I love you so much! ðŸ’–ðŸ¥°ðŸŒ¹</div>
</div>

<audio id="bgMusic" loop>
  <source src="love-song.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
// YOUR MEDIA
const images = [
  "Photo1.jpg","Photo2.jpg","Photo3.jpg","Photo4.jpg","Photo5.jpg",
  "Photo6.jpg","Photo7.jpg","Photo8.jpg","Photo9.jpg","Photo10.jpg",
  "Photo11.jpg","Photo12.jpg","Photo13.jpg","Photo14.jpg"
];
const videos = [
  "Video1.mp4","Video2.mp4","Video3.mp4","Video4.mp4","Video5.mp4"
];

const noBtn = document.getElementById("no");
const yesBtn = document.getElementById("yes");
const questionCard = document.getElementById("questionCard");
const celebrateCard = document.getElementById("celebrateCard");
const bgMusic = document.getElementById("bgMusic");
const backgroundGrid = document.getElementById("backgroundGrid");

let confettiInterval;

// Move â€œNoâ€ away
let noActivated = false;
function moveNoBtn() {
  if (!noActivated) {
    noBtn.style.position = "absolute";
    noActivated = true;
  }
  const rect = questionCard.getBoundingClientRect();
  const btnRect = noBtn.getBoundingClientRect();
  noBtn.style.left = Math.random() * (rect.width-btnRect.width-10) + "px";
  noBtn.style.top  = Math.random() * (rect.height-btnRect.height-10) + "px";
}
noBtn.addEventListener("mouseenter", moveNoBtn);
noBtn.addEventListener("click", moveNoBtn);

// On YES
yesBtn.addEventListener("click", () => {
  questionCard.style.display = "none";
  celebrateCard.style.display = "block";

  bgMusic.volume = 0.5;
  bgMusic.play();

  confettiInterval = setInterval(() => {
    confetti({
      particleCount: 120,
      spread: 100,
      startVelocity: 35,
      origin: { x: Math.random(), y: Math.random()*0.4 }
    });
  }, 700);

  startBackgroundGrid();
});

// Keep track of *currently playing videos* so we donâ€™t overload
let playingVideos = [];

// Start grid
function startBackgroundGrid() {
  backgroundGrid.style.display = "grid";
  backgroundGrid.innerHTML = "";
  for (let i = 0; i < 10; i++) {
    const cell = document.createElement("div");
    backgroundGrid.appendChild(cell);
    preloadAndShow(cell);      // show immediately
    scheduleCellChange(cell);  // schedule future
  }
}

// Preload media and show it
function preloadAndShow(cell) {
  preloadNextMedia().then(next => {
    // Fade out old smoothly
    const old = cell.querySelector(".grid-media");
    if (old) {
      old.style.opacity = "0";
      setTimeout(() => old.remove(), 800);
    }

    // Manage video play count
    if (next.tagName === "VIDEO") {
      // if many videos already playing, downgrade to image
      if (playingVideos.length >= 3) {
        const img = new Image();
        img.src = images[Math.floor(Math.random()*images.length)];
        next.remove(); // discard bad video
        showElement(cell, img);
        return;
      }
      // track video
      playingVideos.push(next);
      // remove from array on end
      next.onended = () => {
        playingVideos = playingVideos.filter(v => v !== next);
      };
    }

    showElement(cell, next);
  });
}

// Helper to show element with fade
function showElement(cell, media) {
  media.className = "grid-media";
  media.style.opacity = "0";
  cell.appendChild(media);
  requestAnimationFrame(() => media.style.opacity = "1");
}

// Preload next media
function preloadNextMedia() {
  return new Promise(resolve => {
    const useVideo = Math.random() < 0.3 && videos.length > 0;
    if (useVideo) {
      const v = document.createElement("video");
      const src = videos[Math.floor(Math.random()*videos.length)];
      v.src = src;
      v.muted = true;
      v.playsInline = true;
      v.autoplay = true;
      // preload metadata then resolve
      v.addEventListener("loadedmetadata", () => resolve(v));
      return;
    }
    const img = new Image();
    const src = images[Math.floor(Math.random()*images.length)];
    img.src = src;
    img.onload = () => resolve(img);
  });
}

// Change at random intervals
function scheduleCellChange(cell) {
  const delay = 2000 + Math.random() * 2500;
  setTimeout(() => {
    preloadAndShow(cell);
    scheduleCellChange(cell);
  }, delay);
}

</script>
</body>
</html>
